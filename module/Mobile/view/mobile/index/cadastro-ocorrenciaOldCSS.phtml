<?php
$form = $this->form;
$form->setAttribute('action', $this->url('mobile', array('action' => 'cadastro-ocorrencia')));
$form->prepare();

// Adiciona os IDs corretos para que o JavaScript encontre os campos
$form->get('municipio')->setAttribute('id', 'autocomplete-municipio');
$form->get('uf')->setAttribute('id', 'autocomplete-uf');
$form->get('coordenacao')->setAttribute('id', 'autocomplete-coordenacao');
$form->get('categoria')->setAttribute('id', 'categoria');
$form->get('subcategoria')->setAttribute('id', 'subcategoria');
$form->get('impacto_aplicacao')->setAttribute('id', 'impacto_aplicacao');
$form->get('nro_processo')->setAttribute('id', 'nro_processo');
?>

<div class="row">
    <div class="col-xs-12">
        <h2 style="text-align: center; margin-bottom: 20px;">Cadastro de Ocorrência</h2>
        
        <?php // ID alterado para evitar a interceptação do AJAX e permitir o redirect do PHP ?>
        <form action="<?=$this->url('mobile', array('action' => 'cadastro-ocorrencia'))?>" method="post" id="mobile-cadastro-alerta" enctype="multipart/form-data" class="cadastro-alerta">
        
            <fieldset>
                <div class="row content-body">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label style="font-size: 16px !important;">* Avaliação Pedagógica</label>
                            <input type="text" style="font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);" class="form-control" value="<?=$this->escapeHtml($this->sistema)?>" disabled>
                        </div>

                        
                        <?php
                        $form->get('DiaAplicacao')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                        ?>
                        <div class="form-group">
                            <label style="font-size: 16px !important;">
                                <?=($this->sistema=='Enem') ? '*' : ''?> Dia da aplicação
                            </label>
                            <?=$this->formRowNoLabel($form->get('DiaAplicacao'));?>
                        </div>



                        <?php
                        $form->get('municipio')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                        ?>

                        <div class="form-group">
                            <label for="municipio" style="font-size: 16px !important;">
                                * Município<br>
                                <small style="font-size: 12px !important; color: #888; font-weight: normal;">
                                    Digite o nome do município (mínimo 3 letras) e aguarde a lista de sugestões.
                                </small>
                            </label>
                            <?=$this->formRowNoLabel($form->get('municipio'));?>
                        </div>

                        
                        <?=$this->formRowNoLabel($form->get('uf'));?>


                        <?php
                        $form->get('coordenacao')->setAttribute('style', 'font-size: 12px;border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                        ?>

                        <div class="form-group">
                            <label for="categoria" style="font-size: 16px !important;">
                                Coordenação<br>
                                <small style="font-size: 12px !important; color: #888; font-weight: normal;">
                                    As coordenações serão carregadas automaticamente após você selecionar um Município.
                                </small>
                            </label>
                            <?=$this->formRowNoLabel($form->get('coordenacao'));?>
                        </div>

                        

                        <?php
                        $form->get('categoria')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                        ?>

                        <div class="form-group">
                            <label for="categoria" style="font-size: 16px !important;">
                                * Categoria<br>
                                <small style="font-size: 12px !important; color: #888; font-weight: normal;">
                                    Selecione na lista a categoria e subcategoria que melhor descreve a ocorrência.
                                </small>
                            </label>
                            <?=$this->formRowNoLabel($form->get('categoria'));?>
                        </div>

                        

                            <?php
                            $form->get('subcategoria')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                            ?>

                            <div class="form-group subcategorias" style="display:none;">
                                <label style="font-size: 16px !important;">Subcategoria</label>
                                <?=$this->formRowNoLabel($form->get('subcategoria'));?>
                            </div>



                            <?php
                            $form->get('impacto_aplicacao')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                            ?>

                            <div class="form-group impacto-aplicacao" style="display:none;">
                                <label style="font-size: 16px !important;">* Impacto na Aplicação?</label>
                                <?=$this->formRowNoLabel($form->get('impacto_aplicacao'));?>
                            </div>


                         <div class="form-group nro-processo" style="display:none;">
                            <label>* N° Processo</label>
                            <?=$this->formRowNoLabel($form->get('nro_processo'));?>
                        </div>

                        <?=$this->formRowNoLabel($form->get('titulo'));?>

                        <?php
                        $form->get('descricao')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                        ?>

                        <div class="form-group">
                            <label for="descricao" style="font-size: 16px !important;">* Descrição da Ocorrência</label>
                            <?=$this->formRowNoLabel($form->get('descricao'));?>
                        </div>
                        

                            <?php
                            $form->get('providencias_adotadas')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                            ?>

                            <div class="form-group">
                                <label for="descricao" style="font-size: 16px !important;">Providências Adotadas</label>
                                <?=$this->formRowNoLabel($form->get('providencias_adotadas'));?>
                            </div>

                        

                            <?php
                            $form->get('anexo')->setAttribute('style', 'font-size: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);');
                            ?>

                            <div class="form-group">
                                <label for="descricao" style="font-size: 16px !important;">
                                    Anexar Arquivos (Imagens e/ou Documentos)
                                </label>
                                <?=$this->formRowNoLabel($form->get('anexo'));?>
                            </div>

                    </div>
                </div>
            </fieldset>

            <hr/>

            <div class="form-group text-center">
                <button type="submit" class="btn btn-primary btn-lg">Salvar</button>
                <a href="<?=$this->url('mobile')?>" class="btn btn-default btn-lg">Cancelar</a>
            </div>
            
        </form>
    </div>
</div>